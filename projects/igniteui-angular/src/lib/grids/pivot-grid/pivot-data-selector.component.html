<div class="igx-pivot-data-selector__filter">
    <igx-input-group type="box" [displayDensity]="displayDensity">
        <igx-icon igxPrefix>search</igx-icon>
        <input
            #input
            igxInput
            tabindex="0"
            placeholder="Search"
            autocomplete="off"
        />
    </igx-input-group>
    <igx-list [displayDensity]="displayDensity">
        <igx-list-item
            *ngFor="
                let dimension of grid.pivotConfiguration.columns
                    .concat(grid.pivotConfiguration.rows)
                    .concat(grid.pivotConfiguration.filters)
            "
        >
            <igx-checkbox
                [disableRipple]="true"
                [checked]="dimension.enabled"
                (click)="toggleDimension(dimension)"
            ></igx-checkbox>
            <span>{{ dimension.memberName }}</span>
        </igx-list-item>
    </igx-list>
</div>

<igx-accordion>
    <igx-expansion-panel
        [animationSettings]="animationSettings"
        [collapsed]="false"
        *ngFor="let panel of _panels"
    >
        <igx-expansion-panel-header
            iconPosition="left"
            [disabled]="false"
            igxDrop
            (enter)="onPanelEntry($event, panel.name)"
            (dropped)="onItemDropped($event, panel.type)"
        >
            <igx-expansion-panel-title class="igx-pivot-data-selector__header">
                <h6 class="igx-pivot-data-selector__header-title">
                    {{ panel.name }}
                </h6>
                <div class="igx-pivot-data-selector__header-extra">
                    <igx-icon>{{ panel.icon }}</igx-icon>
                    <igx-chip>{{ this.grid[panel.dataKey].length }}</igx-chip>
                </div>
            </igx-expansion-panel-title>
        </igx-expansion-panel-header>
        <igx-expansion-panel-body
            igxDrop
            (enter)="onPanelEntry($event, panel.name)"
            (dropped)="onItemDropped($event, panel.type)"
        >
            <igx-list
                *ngIf="this.grid[panel.dataKey].length > 0"
                [displayDensity]="displayDensity"
            >
                <igx-list-item
                    [igxDrag]="panel.dragChannels"
                    ghostClass="igx-pivot-data-selector__item-ghost"
                    [ghostTemplate]="itemGhost"
                    (ghostCreate)="ghostCreated($event, item[panel.itemKey])"
                    (dragMove)="onItemDragMove($event)"
                    *ngFor="
                        let item of this.grid[panel.dataKey];
                        scrollOrientation: 'vertical';
                        let index
                    "
                    [id]="item[panel.itemKey]"
                >
                    <div class="igx-pivot-data-selector__item">
                        <div
                            class="igx-pivot-data-selector__item-text"
                            [class.igx-pivot-data-selector__action-sort]="
                                panel.sortable
                            "
                            (click)="onItemSort($event, item, panel.type)"
                        >
                            <span *ngIf="panel.type === null">{{
                                item.aggregate.key
                            }}</span>
                            <span *ngIf="panel.type === null">(</span>
                            <span>{{ item[panel.itemKey] }}</span>
                            <span *ngIf="panel.type === null">)</span>
                        </div>
                        <div class="igx-pivot-data-selector__item-actions">
                            <igx-icon
                                class="igx-pivot-data-selector__action-sort"
                                *ngIf="panel.sortable && item.sortDirection"
                                (click)="onItemSort($event, item, panel.type)"
                            >
                                {{
                                    item.sortDirection < 2
                                        ? "arrow_upward"
                                        : "arrow_downward"
                                }}
                            </igx-icon>
                            <igx-icon
                                class="igx-pivot-data-selector__action-summary"
                                *ngIf="panel.type === null"
                                (click)="onSummaryClick($event, item, dropdown)"
                                [igxDropDownItemNavigation]="dropdown"
                            >
                                functions
                            </igx-icon>
                            <igx-icon
                                igxDragHandle
                                class="igx-pivot-data-selector__action-move"
                                *ngIf="panel.dragChannels.length > 0"
                                >drag_handle</igx-icon
                            >
                        </div>
                    </div>
                </igx-list-item>
            </igx-list>
            <div
                class="igx-pivot-data-selector__empty"
                *ngIf="this.grid[panel.dataKey].length === 0"
            >
                Drag Items Here
            </div>
        </igx-expansion-panel-body>
    </igx-expansion-panel>
</igx-accordion>

<igx-drop-down #dropdown (selectionChanging)="onAggregationChange($event)">
    <igx-drop-down-item
        *ngFor="let item of aggregateList"
        [selected]="isSelected(item)"
        [value]="item"
    >
        {{ item.label }}
    </igx-drop-down-item>
</igx-drop-down>

<ng-template #itemGhost>
    <div [style.width.px]="ghostWidth" [class.igx-pivot-data-selector__item-ghost--no-drop]="!dropAllowed">
        <div style="display: flex; align-items: center">
            <igx-icon style="margin-right: 8px">unfold_more</igx-icon>
            <span>{{ ghostText }}</span>
        </div>
        <igx-icon>drag_handle</igx-icon>
    </div>
</ng-template>
